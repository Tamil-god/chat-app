<!DOCTYPE html>
<html>
<head>
  <title>Chat</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
  <div class="chat-container">
    <h2>ðŸ”¥ Chat Room</h2>
    <div id="chat-box"></div>
    <div id="typing-status"></div>
    <input type="text" id="username" placeholder="Your name">
    <input type="text" id="message" placeholder="Message">
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    const socket = io();
    const chatBox = document.getElementById("chat-box");
    const typingStatus = document.getElementById("typing-status");

    socket.on("load_messages", data => {
      data.forEach(msg => appendMessage(msg));
    });

    socket.on("receive_message", msg => {
      appendMessage(msg);
    });

    socket.on("show_typing", username => {
      typingStatus.innerText = `${username} is typing...`;
      setTimeout(() => typingStatus.innerText = "", 2000);
    });

    function sendMessage() {
      const username = document.getElementById("username").value.trim();
      const message = document.getElementById("message").value.trim();
      if (username && message) {
        socket.emit("new_message", { username, message });
        document.getElementById("message").value = "";
      }
    }

    document.getElementById("message").addEventListener("input", () => {
      const username = document.getElementById("username").value.trim();
      if (username) {
        socket.emit("typing", username);
      }
    });

    function appendMessage({ username, message, timestamp }) {
      const div = document.createElement("div");
      div.innerHTML = `<b>${username}</b>: ${message} <span class="timestamp">[${timestamp}]</span>`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>
</body>
</html>
